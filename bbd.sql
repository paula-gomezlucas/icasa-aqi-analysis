USE psi_grupo2;

CREATE TABLE ICA(
	VALOR INT,
    PRIMARY KEY (VALOR)
);

CREATE TABLE LOCALIZACION(
	idloc int,
    latitud DECIMAL(8, 6),
    longitud DECIMAL(8, 6),
    idregion varchar(25),
    nombre varchar(30),
    mediaICA int,
	PRIMARY KEY(idloc)
);

ALTER TABLE LOCALIZACION
  ADD CONSTRAINT uq_LOCALIZACION UNIQUE(LATITUD, LONGITUD);

CREATE TABLE EN(
	FECHA DATE,
    ICA INT,
    LATITUD DECIMAL(8, 6),
    LONGITUD DECIMAL(8, 6),
    PRIMARY KEY(FECHA, ICA, LATITUD, LONGITUD),
    FOREIGN KEY (ICA) REFERENCES ICA(VALOR),
    FOREIGN KEY (LATITUD, LONGITUD) REFERENCES LOCALIZACION(LATITUD, LONGITUD)
);

CREATE TABLE USUARIO(
	EMAIL VARCHAR(50),
    HASHPASS VARCHAR(32),
    ROL BOOLEAN,
    NOMBRE VARCHAR(15),
    PRIMARY KEY(EMAIL)
);

INSERT INTO USUARIO(EMAIL, HASHPASS, ROL, NOMBRE) VALUES ('usgestor@usgestor.com', '15c7a5fe3375815a68ae581c0d54e11a', '1', 'GESTOR 1');
INSERT INTO USUARIO(EMAIL, HASHPASS, ROL, NOMBRE) VALUES ('usgenerico@usgenerico.com', 'df2cf1c58f2804df167b0191d79b07a4', '0', 'GENERICO 1');

ALTER TABLE USUARIO
ADD COLUMN ALTA BOOLEAN;

UPDATE USUARIO
SET ALTA = TRUE
WHERE NOMBRE = 'GESTOR 1' OR NOMBRE = 'GENERICO 1';

CREATE TABLE your_table_name (
  id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  EMAIL VARCHAR(255),
  HASHPASS VARCHAR(255),
  ROL INT,
  NOMBRE VARCHAR(255),
  ALTA INT
);

INSERT INTO USUARIO
  (EMAIL,HASHPASS,ROL,NOMBRE,ALTA)
VALUES
  ('g2@usgestor.com','c1572d05424d0ecb2a65ec6a82aeacbf',1,'GESTOR 2',1),
  ('g3@usgestor.com','3afc79b597f88a72528e864cf81856d2',1,'GESTOR 3',1),
  ('g4@usgestor.com','fc2921d9057ac44e549efaf0048b2512',1,'GESTOR 4',1),
  ('g5@usgestor.com','d35f6fa9a79434bcd17f8049714ebfcb',1,'GESTOR 5',1),
  ('g6@usgestor.com','e9568c9ea43ab05188410a7cf85f9f5e',1,'GESTOR 6',1),
  ('g7@usgestor.com','8c96c3884a827355aed2c0f744594a52',1,'GESTOR 7',1),
  ('g8@usgestor.com','ccd3cd18225730c5edfc69f964b9d7b3',1,'GESTOR 8',1),
  ('g9@usgestor.com','c28cce9cbd2daf76f10eb54478bb0454',1,'GESTOR 9',1),
  ('g2@usgenerico.com','c1572d05424d0ecb2a65ec6a82aeacbf',0,'GENERICO 2',1),
  ('g3@usgenerico.com','3afc79b597f88a72528e864cf81856d2',0,'GENERICO 3',1),
  ('g4@usgenerico.com','fc2921d9057ac44e549efaf0048b2512',0,'GENERICO 4',1),
  ('g5@usgenerico.com','d35f6fa9a79434bcd17f8049714ebfcb',0,'GENERICO 5',1);

UPDATE USUARIO
SET ALTA = FALSE
WHERE NOMBRE = 'GENERICO 5';

INSERT INTO LOCALIZACION
  (IDLOC,MEDIAICA,IDREGION,nombre,LATITUD,LONGITUD)
VALUES
  (28005002,18,'MADRID','ALCALÁ DE HENARES','40.481660','-3.364136'),
  (28006004,16,'MADRID','ALCOBENDAS','40.547540','-3.642091'),
  (28013002,20,'MADRID','ARANJUEZ','40.032090','-3.603288'),
  (28014002,21,'MADRID','ARGANDA DEL REY','40.300950','-3.438080'),
  (28016001,14,'MADRID','EL ATAZAR','40.933330','-3.466667'),
  (28045002,17,'MADRID','COLMENAR VIEJO','40.658950','-3.766043'),
  (28049003,22,'MADRID','COSLADA','40.425940','-3.565464'),
  (28058004,20,'MADRID','FUENLABRADA','40.283870','-3.800329'),
  (28065014,19,'MADRID','GETAFE','40.304980','-3.732677'),
  (28067001,15,'MADRID','GUADALIX DE LA SIERRA','40.784830','-3.692719'),
  (28074007,24,'MADRID','LEGANÉS','40.326420','-3.758988'),
  (28079008,18,'MADRID','ESCUELAS AGUIRRE','40.421455','-3.681701'),
  (28079018,20,'MADRID','FAROLILLO','40.394984','-3.731834'),
  (28079024,19,'MADRID','CASA DE CAMPO','40.427256','-3.747990'),
  (28079036,20,'MADRID','MORATALAZ','40.407905','-3.643468'),
  (28079038,16,'MADRID','CUATRO CAMINOS-PABLO IGLESIAS','40.447097','-3.708353'),
  (28079040,21,'MADRID','PUENTE DE VALLECAS','40.385041','-3.659851'),
  (28079047,18,'MADRID','MENDEZ ALVARO','40.398858','-3.677361'),
  (28079048,18,'MADRID','CASTELLANA','40.453605','-3.689525'),
  (28079050,21,'MADRID','PLAZA CASTILLA-CANAL','40.466563','-3.689083'),
  (28079056,17,'MADRID','PLAZA ELÍPTICA','40.385207','-3.717300'),
  (28079057,17,'MADRID','SANCHINARRO','40.495055','-3.655512'),
  (28079060,14,'MADRID','TRES OLIVOS','40.501590','-3.691521'),
  (28080003,16,'MADRID','MAJADAHONDA','40.472830','-3.872304'),
  (28092005,18,'MADRID','MÓSTOLES','40.322770','-3.865741'),
  (28102001,15,'MADRID','ORUSCO DE TAJUÑA','40.285150','-3.208557'),
  (28120001,11,'MADRID','PUERTO DE COTOS','40.903810','-3.879398'),
  (28123002,21,'MADRID','RIVAS-VACIAMADRID ','40.354550','-3.533586'),
  (28133002,15,'MADRID','SAN MARTIN DE VALDEIGLESIAS ','40.361740','-4.397521'),
  (28148004,22,'MADRID','TORREJON DE ARDOZ ','40.458900','-3.479771'),
  (28171001,18,'MADRID','VILLA DEL PRADO','40.276780','-4.305642');

INSERT INTO LOCALIZACION
  (IDLOC,IDREGION,nombre,Latitud,Longitud,MediaICA)
VALUES
  (3002002,'COMUNIDAD VALENCIANA','AGOST',38.44117,-0.6395459,18),
  (3009006,'COMUNIDAD VALENCIANA','ALCOI - VERGE DELS LLIRIS',38.6983,-0.473611,12.5),
  (3014006,'COMUNIDAD VALENCIANA','ALACANT-EL PLÁ',38.3548,-0.475758,17.5),
  (3014009,'COMUNIDAD VALENCIANA','ALACANT - RABASSA',38.3656,-0.505778,16.5),
  (3065006,'COMUNIDAD VALENCIANA','ELX-AGROALIMENTARI',38.2669,-0.6983,17.5),
  (3065007,'COMUNIDAD VALENCIANA','ELX-PARC DE BOMBERS',38.2719,-0.695,18),
  (3066003,'COMUNIDAD VALENCIANA','ELDA-LACY',38.4813,-0.790329,11.25),
  (3105001,'COMUNIDAD VALENCIANA','EL PINÓS',38.4033,-1.0422,12),
  (3133002,'COMUNIDAD VALENCIANA','TORREVIEJA',37.97747,-0.6832271,5.4),
  (12005004,'COMUNIDAD VALENCIANA','L''ALCORA-PM',40.0667,-0.2,16.5),
  (12005005,'COMUNIDAD VALENCIANA','ALCORA',40.0667,-0.2,21.5),
  (12009007,'COMUNIDAD VALENCIANA','ALMASSORA-C. P. OCHANDO',39.9547,-0.095,9),
  (12028001,'COMUNIDAD VALENCIANA','BENICASSIM',40.0553,40.0553,7),
  (12032001,'COMUNIDAD VALENCIANA','BURRIANA',39.8894,-0.0925,5.9),
  (12032005,'COMUNIDAD VALENCIANA','BURRIANA RESIDENCIA',39.8896,-0.083889,19.5),
  (12040008,'COMUNIDAD VALENCIANA','CASTELLÓ-PENYETA',39.9831,-0.033056,5.2),
  (12040010,'COMUNIDAD VALENCIANA','CASTELLÓ-GRAU',39.9749,0.011611,20),
  (12046001,'COMUNIDAD VALENCIANA','CIRAT',40.05533,-0.4632015,13),
  (12080007,'COMUNIDAD VALENCIANA','MORELLA',40.619,-0.0977334,8.6),
  (12084003,'COMUNIDAD VALENCIANA','ONDA',39.9653,-0.2626455,18.5),
  (12099001,'COMUNIDAD VALENCIANA','SANT JORDI',40.5094,0.331944,10.85),
  (12124001,'COMUNIDAD VALENCIANA','VALL D''ALBA PM',40.1667,-0.033333,17.5),
  (12135004,'COMUNIDAD VALENCIANA','VILA-REAL-PM',41.2958,-7.7461,21.5),
  (12140002,'COMUNIDAD VALENCIANA','VIVER',39.92135,-0.5944216,8.8),
  (12141002,'COMUNIDAD VALENCIANA','ZORITA',40.7283,-0.166111,11.45),
  (46010001,'COMUNIDAD VALENCIANA','ALBALAT DELS TARONGERS',39.70299,-0.3364196,5),
  (46017002,'COMUNIDAD VALENCIANA','ALZIRA',39.15159,-0.4404637,15),
  (46028001,'COMUNIDAD VALENCIANA','ALGAR DE PALÀNCIA',39.781095,-0.367464,4.85),
  (46062001,'COMUNIDAD VALENCIANA','BENIGANIM',38.9436,-0.443889,19),
  (46077006,'COMUNIDAD VALENCIANA','BUÑOL CEMEX',39.4194,-0.790556,11.15),
  (46078004,'COMUNIDAD VALENCIANA','BURJASSOT - FACULTATS',39.5091,-0.410858,18.5),
  (46095001,'COMUNIDAD VALENCIANA','CAUDETE DE LAS FUENTES',39.56,-1.27799,8.95),
  (46102002,'COMUNIDAD VALENCIANA','QUART DE POBLET',39.48259,-0.4450733,18),
  (46131002,'COMUNIDAD VALENCIANA','GANDÍA',38.9667,-0.183333,12),
  (46184002,'COMUNIDAD VALENCIANA','ONTINYENT',38.82102,-0.610547,13.5),
  (46190005,'COMUNIDAD VALENCIANA','PATERNA-CEAM',39.9860,-0.037439,15.5),
  (46220003,'COMUNIDAD VALENCIANA','SAGUNT PORT',39.6764,-0.273333,14),
  (46220009,'COMUNIDAD VALENCIANA','SAGUNT-NORD',39.6764,-0.273333,15.5),
  (46220010,'COMUNIDAD VALENCIANA','SAGUNT CEA',39.6757,-0.2774,12),
  (46242001,'COMUNIDAD VALENCIANA','TORREBAJA',40.09685,-1.257538,11),
  (46244003,'COMUNIDAD VALENCIANA','TORRENT-EL VEDAT',39.4365,-0.4679,15.5),
  (46250030,'COMUNIDAD VALENCIANA','VALÈNCIA-PISTA DE SILLA',39.3958,-0.39,12),
  (46250043,'COMUNIDAD VALENCIANA','VALÈNCIA-VIVERS',39.4806,-0.368211,18.5),
  (46250046,'COMUNIDAD VALENCIANA','VALÈNCIA-POLITÈCNIC',39.4809,-0.34111,10.2),
  (46250047,'COMUNIDAD VALENCIANA','VALÈNCIA - AVD. FRANCIA',39.47,-0.376389,12.5),
  (46250048,'COMUNIDAD VALENCIANA','VALÈNCIA - MOLÍ DEL SOL',39.4817,-0.409722,15.5),
  (46250050,'COMUNIDAD VALENCIANA','VALÈNCIA - BULEVARD SUD',39.4499,-0.39494,21.5),
  (46250054,'COMUNIDAD VALENCIANA','VALÈNCIA-CENTRE',39.4736,-0.378921,19.5),
  (46256001,'COMUNIDAD VALENCIANA','VILAMARXANT',39.56751,-0.6222726,11.5),
  (46258001,'COMUNIDAD VALENCIANA','VILLAR DEL ARZOBISPO',39.73537,-0.8277042,11),
  (46263999,'COMUNIDAD VALENCIANA','ZARRA',39.09138,-1.075068,9.6);

SELECT * FROM LOCALIZACION ORDER BY IDREGION, NOMBRE;